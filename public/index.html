{% comment %} <!-- 

Copyright 2016-present, Facebook, Inc.
All rights reserved.

This source code is licensed under the license found in the
LICENSE file in the root directory of this source tree.

-->
<html>
  <head>
    <title>Messenger Demo</title>
  </head>
  <body>
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId: '2870467962978963',
          xfbml: true,
          version: 'v2.6'
        });
      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
    </script>

    <h1>Messenger Demo</h1>

    <div>
      <p>The "Send to Messenger" plugin will trigger an authentication callback to your webhook.</p>

      <div class="fb-send-to-messenger" 
        messenger_app_id='2870467962978963'
        page_id='339878070163410'
        data-ref="PASS_THROUGH_PARAM" 
        color="blue" 
        size="standard">
      </div>
    </div>

    <div>
      <p>The "Message Us" plugin takes the user directly to Messenger and into a thread with your Page.</p>

      <div class="fb-messengermessageus" 
        messenger_app_id='2870467962978963'
        page_id='339878070163410'
        color="blue"
        size="standard">
      </div>
    </div>

  </body>
</html> {% endcomment %}

<html>
<head>
    <title>Choose your preferences</title>
</head>
<body>
<script>
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {
            return;
        }
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'Messenger'));

    window.extAsyncInit = () => {
        // TODO: How to parse env file from here?
        MessengerExtensions.getSupportedFeatures(function success(result) {
            let features = result.supported_features;
            if (features.includes("context")) {
                MessengerExtensions.getContext('<APP_ID>',
                    function success(thread_context) {
                        // success
                        document.getElementById("psid").value = thread_context.psid;
                    },
                    function error(err) {
                        // error
                        console.log(err);
                    }
                );
            }
        }, function error(err) {
            // error retrieving supported features
            console.log(err);
        });
        document.getElementById('submitButton').addEventListener('click', () => {
            MessengerExtensions.requestCloseBrowser(function success() {
                console.log("Webview closing");
            }, function error(err) {
                console.log(err);
            });
        });
    };

</script>
<form action="/optionspostback" method="get">
    <input type="hidden" name="psid" id="psid">
    <h3>Pillows</h3>
    <input type="radio" name="pillows" value="soft" checked>Soft<br>
    <input type="radio" name="pillows" value="hard">Hard<br>
    <h3>Bed</h3>
    <input type="radio" name="bed" value="single" checked>Single<br>
    <input type="radio" name="bed" value="double">Double<br>
    <input type="radio" name="bed" value="twin">Twin<br>
    <h3>View</h3>
    <input type="radio" name="view" value="sea" checked>Sea<br>
    <input type="radio" name="view" value="street">Street<br>
    <input type="submit" value="Submit" id="submitButton">
</form>
</body>
</html>